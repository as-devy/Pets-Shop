<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="./imgs/favicon.ico">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/icons.css">
    <link rel="stylesheet" href="./css/adoption.css">

    <title>Paws Safe - Fostering</title>
</head>

<body>
    <div class="preloader">
        <img src="./imgs/preloader.gif" alt="">
    </div>
    <header>
        <div class="container">
            <div class="lg" style="width: 268px;">
                <a href="./" class="logo">
                    <img src="./imgs/logo.png" alt="pawsafe">
                    <h3>Paws Safe</h3>
                </a>
            </div>
            <ul class="nav">
                <li><a href="./index.html"><i class="fa-solid fa-house"></i> Home</a></li>
                <li><a class="active" href="./foster.html"><i class="fa-solid fa-paw"></i> Foster</a></li>
                <li><a href="./rehoming.html"><i class="fa-solid fa-hand-holding-heart"></i> Adoption</a></li>
                <li> <a href="./postpet.html" class="post_pet "><i class="fas fa-upload"></i> Post Pet </a></li>
                <li><a href="./index.html#contact_us"><i class="fas fa-phone"></i> Contact Us</a></li>
            </ul>
            <div class="auth">

                <div class="register">

                    <a href="./login.html" class="login">Login</a>
                    <a href="./signup.html" class="signup"><i class="fa-solid fa-user"></i> Sign Up</a>
                </div>

                <div style="display: flex; align-items: center; gap:1rem">
                    <button class="notif d_none" id="notif_btn"><i class="fa-solid fa-bell"></i>
                        <span class="notif_length"></span>
                    </button>

                    <div id="user_personal" class="d_none">Hi, <b id="user_name"></b> <i
                            class="fa-solid fa-caret-down"></i></div>
                </div>
                <div class="personal_info ">
                    <div class="info"><span>Email:</span> <b id="user-email"></b></div>
                    <div class="action_btns">
                        <a href="./admin_dashboard.html" id="dashboard_btn" class="verify_account d_none"><i
                            class="fa-solid fa-badge-check"></i> Dashboard</a>
                        <a href="./mypets.html" class="verify_account"><i class="fa-solid fa-paw"></i> My Pets</a>
                        <a href="./verification.html" id="get_verify_btn" class="verify_account"><i
                                class="fa-solid fa-badge-check"></i> Get
                            Verified</a>
                        <a href="#" class="logout"><i class="fa-solid fa-right-from-bracket"></i> Logout </a>
                    </div>
                </div>
                <div class="notif_list" id="notif_list">
                    <div style="display: flex;align-items: center;justify-content: space-between;margin-bottom: 10px;">
                        <h3>Notifications</h3>
                        <a href="#" class="d_none" id="clear_notifis">Clear All</a>
                    </div>
                    <p class="info d_none" style="color: #505050;padding: 8px;">You Don't Have Notifications.</p>
                    <ul>

                    </ul>
                </div>

            </div>
        </div>
    </header>
    <main class="adoption">
        <div class="banner">
            <div>
                <h1>Foster A Pet</h1>
                <span>Home > Foster</span>
            </div>
        </div>
        <section>
            <div class="container">
                <div class="filter ">
                    <div class="sticky-div">
                        <div class="filter-container">
                            <div style="display: flex;align-items: center;">
                                <i class="fas fa-globe"></i>
                                <b>Country:</b>
                            </div>
                            <select id="countryFilter">
                                <option value="all">All Countries</option>

                            </select>
                        </div>
                        <div class="categories">
                            <ul>
                                <li id="category_item" data-category="all">
                                    <div class="icon" style="background-color: var(--primary_color);"> <i
                                            style="color: #fff;" class="fa-solid fa-paw"></i></div>
                                    <h4>All</h4>
                                    <span class="category-length"> (<span id="all_length">0</span>)</span>
                                </li>
                                <li id="category_item" data-category="dog">
                                    <div class="icon" style="background-color: #ff3d41;"> <img
                                            src="./imgs/category-dog.svg" alt="Dog"></div>
                                    <h4>Dogs</h4>
                                    <span class="category-length"> (<span id="dogs_length">0</span>)</span>
                                </li>
                                <li id="category_item" data-category="cat">
                                    <div class="icon" style="background-color: #ffb13d"> <img
                                            src="./imgs/category-cats.svg" alt="Dog"></div>
                                    <h4>Cats</h4>
                                    <span class="category-length"> (<span id="cats_length">0</span>)</span>
                                </li>
                                <li id="category_item" data-category="rabbit">
                                    <div class="icon" style="background-color: #3d68ff"> <img
                                            src="./imgs/category-rabbit.svg" alt="Dog"></div>
                                    <h4>Rabbits</h4>
                                    <span class="category-length"> (<span id="rabbits_length">0</span>)</span>
                                </li>
                                <li id="category_item" data-category="bird">
                                    <div class="icon" style="background-color: #ff27b6"> <img
                                            src="./imgs/category-birds.svg" alt="Dog"></div>
                                    <h4>Birds</h4>
                                    <span class="category-length"> (<span id="birds_length">0</span>)</span>
                                </li>
                                <li id="category_item" data-category="fish">
                                    <div class="icon" style="background-color: #21cd1e"> <img
                                            src="./imgs/category-fish.svg" alt="Dog"></div>
                                    <h4>Fish</h4>
                                    <span class="category-length"> (<span id="fish_length">0</span>)</span>
                                </li>
                                <li id="category_item" data-category="other">
                                    <div class="icon" style="background-color: #ac46ec"> <img
                                            src="./imgs/category-others.svg" alt="Dog"></div>
                                    <h4>Others</h4>
                                    <span class="category-length"> (<span id="others_length">0</span>)</span>
                                </li>
                            </ul>

                        </div>
                    </div>
                </div>
                <div class="petlist">
                    <div class="list">

                    </div>
                </div>
            </div>
        </section>
    </main>
    <script>


        let pets = [];
        let pets_countries = [];

        fetch("http://localhost:400/allPets")
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                pets = data;

                console.log(pets)
                let adoptionPets = [];


                pets.forEach(pet => {
                    if (pet.foster) {
                        adoptionPets.push(pet)
                    }
                })

                adoptionPets.map(pet => {
                    pets_countries.push(pet.country)

                })
                pets_countries = [...new Set(pets_countries)]
                pets_countries.forEach(country => {
                    document.querySelector("#countryFilter").innerHTML += `<option value="${country.toLowerCase().replace(" ", "_")}">${country}</option>`
                });

                const countCategories = (arr) => {
                    const categoryCount = {
                        "others": 0,
                        "cat": 0,
                        "dog": 0,
                        "bird": 0,
                        "rabbit": 0,
                        "fish": 0
                    }

                    const knownCategories = ["cat", "dog", "bird", "rabbit", "fish"];
                    arr.forEach(pet => {
                        const category = knownCategories.includes(pet.category) ? pet.category : "others";
                        categoryCount[category]++;
                    });

                    document.querySelector("#all_length").innerHTML = arr.length;
                    document.querySelector("#dogs_length").innerHTML = categoryCount.dog;
                    document.querySelector("#cats_length").innerHTML = categoryCount.cat;
                    document.querySelector("#rabbits_length").innerHTML = categoryCount.rabbit;
                    document.querySelector("#birds_length").innerHTML = categoryCount.bird;
                    document.querySelector("#fish_length").innerHTML = categoryCount.fish;
                    document.querySelector("#others_length").innerHTML = categoryCount.others;
                }

                const filterByCategory = (arr) => {
                    // FILTER BY PET CATEGORY
                    document.querySelectorAll(".categories #category_item").forEach(categoryBtn => {
                        categoryBtn.addEventListener("click", () => {
                            document.querySelector(".petlist .list").innerHTML = ""
                            const categoryFilter = categoryBtn.getAttribute("data-category")

                            if (categoryFilter == "other") {
                                arr.map(pet => {
                                    if (pet.category !== "cat" && pet.category !== "dog" && pet.category !== "bird" && pet.category !== "fish" && pet.category !== "rabbit") {
                                        const petElement = document.createElement("div")
                                        petElement.innerHTML = `
                                <div class="pet">
                            <div class="img">
                                <img src="${pet.img}" alt="">
                                <span class="category">${pet.foster ? "Foster" : ""} ${pet.rehoming ? "Adopt" : ""}</span>
                            </div>
                            <div class="text">
                                <p class="requests">${pet.requested ? "Requested" : `${JSON.parse(pet.requests).length} Requests`}</p>
                                <h2 class="name">${pet.name}</h2>
                                <span class="age">${pet.age} Years Old</span>
                                <p class="location"><i class="fa-solid fa-location-dot"></i>
                                    <span> ${pet.country} , ${pet.city}</span>
                                </p>
                                <p class="desc">${pet.description}</p>
                            </div>
                            <a href="./viewPet.html?petId=${pet.id}">more info </a>
                        </div>
                    `
                                        document.querySelector(".petlist .list").append(petElement)
                                    }
                                })
                            } else if (categoryFilter == "all") {
                                arr.map(pet => {
                                    const petElement = document.createElement("div")
                                    petElement.innerHTML = `
                                    <div class="pet">
                            <div class="img">
                                <img src="${pet.img}" alt="">
                                <span class="category">${pet.foster ? "Foster" : ""} ${pet.rehoming ? "Adopt" : ""}</span>
                            </div>
                            <div class="text">
                                <p class="requests">${pet.requested ? "Requested" : `${JSON.parse(pet.requests).length} Requests`}</p>
                                <h2 class="name">${pet.name}</h2>
                                <span class="age">${pet.age} Years Old</span>
                                <p class="location"><i class="fa-solid fa-location-dot"></i>
                                    <span> ${pet.country} , ${pet.city}</span>
                                </p>
                                <p class="desc">${pet.description}</p>
                            </div>
                            <a href="./viewPet.html?petId=${pet.id}">more info </a>
                        </div>
                                `
                                    document.querySelector(".petlist .list").append(petElement)
                                })
                            } else {
                                arr.map(pet => {
                                    if (pet.category == categoryFilter) {
                                        const petElement = document.createElement("div")
                                        petElement.innerHTML = `
                                <div class="pet">
                            <div class="img">
                                <img src="${pet.img}" alt="">
                                <span class="category">${pet.foster ? "Foster" : ""} ${pet.rehoming ? "Adopt" : ""}</span>
                            </div>
                            <div class="text">
                                <p class="requests">${pet.requested ? "Requested" : `${JSON.parse(pet.requests).length} Requests`}</p>
                                <h2 class="name">${pet.name}</h2>
                                <span class="age">${pet.age} Years Old</span>
                                <p class="location"><i class="fa-solid fa-location-dot"></i>
                                    <span> ${pet.country} , ${pet.city}</span>
                                </p>
                                <p class="desc">${pet.description}</p>
                            </div>
                            <a href="./viewPet.html?petId=${pet.id}">more info </a>
                        </div>
                    `
                                        document.querySelector(".petlist .list").append(petElement)
                                    }
                                })
                            }
                            if (document.querySelector(".petlist .list").innerHTML == "") {
                                document.querySelector(".petlist .list").innerHTML = "<p class='msg_defined'>Oops! We couldn’t find any pets matching your search</p>"
                            }
                        })


                    })
                }

                const adoptPets = (arr) => {
                    arr.map(pet => {
                        // ADD PETS TO THE PAGE
                        const petElement = document.createElement("div")
                        petElement.innerHTML = `
                        <div class="pet">
                            <div class="img">
                                <img src="${pet.img}" alt="">
                                <span class="category"> ${pet.emergency ? `<span class="emgIcon"> <i class="fa-solid fa-light-emergency-on"></i></span>` : ""} ${pet.foster ? "Foster" : ""} ${pet.rehoming ? "Adopt" : ""}</span>

                            </div>
                            <div class="text">
                                <p class="requests">${pet.requested ? "Requested" : `${JSON.parse(pet.requests).length} Requests`}</p>
                                <h2 class="name">${pet.name}</h2>
                                <span class="age">${pet.age} Years Old</span>
                                <p class="location"><i class="fa-solid fa-location-dot"></i>
                                    <span> ${pet.country} , ${pet.city}</span>
                                </p>
                                <p class="desc">${pet.description}</p>
                            </div>
                            <a href="./viewPet.html?petId=${pet.id}">more info </a>
                        </div>
                    `
                        document.querySelector(".petlist .list").append(petElement)
                    })

                    countCategories(arr)

                    filterByCategory(arr)
                }

                const urlParams = new URLSearchParams(window.location.search);
                const countrySearch = urlParams.get("country")
                const categorySearch = urlParams.get("category")


                if (countrySearch && categorySearch) {
                    const searchedOption = document.querySelector(`#countryFilter option[value=${countrySearch}]`);
                    if (searchedOption){
                        searchedOption.selected = true;
                    }

                    document.querySelector(".petlist .list").innerHTML = ""
                    let countryPets = [];
                    adoptionPets.map(pet => {
                        if (pet.country.toLowerCase().replace(" ", "_") == countrySearch) {
                            // ADD PETS TO countryPet
                            countryPets.push(pet)
                        } else if (countrySearch == "all") {
                            countryPets = adoptionPets;
                        }
                    })

                    countryPets.map(pet => {
                        if (pet.category == categorySearch) {
                            const petElement = document.createElement("div")
                            petElement.innerHTML = `
                                <div class="pet">
                            <div class="img">
                                <img src="${pet.img}" alt="">
                                <span class="category">${pet.foster ? "Foster" : ""} ${pet.rehoming ? "Adopt" : ""}</span>
                            </div>
                            <div class="text">
                                <p class="requests">${pet.requested ? "Requested" : `${JSON.parse(pet.requests).length} Requests`}</p>
                                <h2 class="name">${pet.name}</h2>
                                <span class="age">${pet.age} Years Old</span>
                                <p class="location"><i class="fa-solid fa-location-dot"></i>
                                    <span> ${pet.country} , ${pet.city}</span>
                                </p>
                                <p class="desc">${pet.description}</p>
                            </div>
                            <a href="./viewPet.html?petId=${pet.id}">more info </a>
                        </div>
                    `
                            document.querySelector(".petlist .list").append(petElement)
                        }
                    })

                    if (document.querySelector(".petlist .list").innerHTML == "") {
                        document.querySelector(".petlist .list").innerHTML = "<p class='msg_defined'>Oops! We couldn’t find any pets matching your search</p>"
                    }

                    countCategories(countryPets)
                    filterByCategory(countryPets)
                } else {
                    adoptPets(adoptionPets)
                }

                // FILTER BY COUNTRY
                document.querySelector("#countryFilter").addEventListener("change", (event) => {
                    document.querySelector(".petlist .list").innerHTML = ""
                    const countryFilter = event.target.value;
                    let countryPets = [];
                    adoptionPets.map(pet => {
                        if (pet.country.toLowerCase().replace(" ", "_") == countryFilter) {
                            // ADD PETS TO countryPet
                            countryPets.push(pet)
                        } else if (countryFilter == "all") {
                            countryPets = adoptionPets;
                        }
                    })
                    adoptPets(countryPets)
                })
            })
            .catch(error => {
                console.error("Error fetching pets:", error);
                document.querySelector(".petlist .list").innerHTML = "<p class='msg_defined'>Internal Server Error!</p>"
            });

        const targetDiv = document.querySelector(".sticky-div");
        const offsetTop = targetDiv.offsetTop;

        window.addEventListener("scroll", () => {
            if (window.scrollY >= offsetTop) {
                targetDiv.classList.add("fixed");
            } else {
                targetDiv.classList.remove("fixed");
            }
        });

    </script>
    <script src="./main.js"></script>
</body>

</html>